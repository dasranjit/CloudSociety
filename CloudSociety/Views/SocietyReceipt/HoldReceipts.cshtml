@model IEnumerable<CloudSocietyEntities.SocietyReceiptOnhold>
@{
    ViewBag.Title = "Society On Hold Receipts";
    ViewBag.Header = "Society On Hold Receipt List";
    ViewBag.SocietyNameHeader = ViewBag.SocietyHead;
    Layout = "~/Views/Shared/SocietyLayout.cshtml";
    Guid? societyId = null;
}
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.0/jquery.min.js"></script>
<link rel="stylesheet" href="../../Content/themes/base/jquery-ui.css">
<script src="../../Scripts/jquery-1.10.2.js"></script>
<script src="../../Scripts/jquery-ui.js"></script>
<script type="text/javascript">
    function toggelContain() {
        $("#tblSearch").toggle();
        if ($("i").hasClass("down")) {
            $("i").removeClass("down");
            $("i").addClass("up");
        } else if ($("i").hasClass("up")) {
            $("i").removeClass("up");
            $("i").addClass("down");
        }
    }

</script>
@using (Html.BeginForm("HoldReceipts", "SocietyReceipt", FormMethod.Get))
{
    @Html.ValidationSummary(false, "Following errors occurred while processing your request")
    <fieldset style="width: 936px; padding: 0 0 0 0 !important; border-radius: 4px !important;">
        <div style="text-align: left; vertical-align: central !important; width: 100%; height: 30px; border-radius: 4px; background-color: #e9e9e9; border: 1px solid #dddddd; cursor: pointer;" onclick="toggelContain()">
            @*<div style="width:100%;height:7px;"></div>*@
            <table style="width: 100%">
                <tr>
                    <td style="width: 90%"><span style="margin-left: 10px !important; font-weight: bold">Search</span></td>
                    <td style="width: 10%"><i style="float: right;" class="down"></i></td>
                </tr>
            </table>
            @*<span style="margin-left: 10px !important;">Search</span><i style="float:right;" class="down"></i>*@
        </div>
        <table style="margin-bottom: 20px; display: none;" id="tblSearch">
            <tr>
                <td>Member Name </td>
                <td>:</td>
                <td>
                    <input type="text" value="@ViewBag.MemberName" name="MemberName" id="MemberName"  class="mediumWidth" />
                </td>
            </tr>
            <tr>
                <td>Building Unit </td>
                <td>:</td>
                <td>
                    <input type="text" value="@ViewBag.BuildingUnit" name="BuildingUnit" id="BuildingUnit" class="mediumWidth" />
                </td>
            </tr>
            <tr>
                <td colspan="3" align="center">
                    <input type="submit" value="Search" class="buttton" style="width: 45px; height: 23px; vertical-align: middle;" onclick="return CompareTwoDates();" />
                </td>
            </tr>
        </table>
    </fieldset>
    @Html.Hidden("id", (Guid)ViewBag.SocietySubscriptionID)
}
<br />

@if (!string.IsNullOrWhiteSpace(ViewBag.CreateReceiptStatusMessage))
{
    <span class="EditDelete">
        @ViewBag.CreateReceiptStatusMessage
    </span>
    <br />
    <br />
}
@if (Model.Count() > 0)
{
    <input type="button" value="Create Receipt For All" onclick="CreateReceipt(null)" class="buttton" style="color: white !important; width: 145px;" />
    <br />
    <br />
}

@if (Model.Count() > 0)
{
    var gridHoldReceipt = new WebGrid(Model, canPage: true, canSort: true, rowsPerPage: 10);
    gridHoldReceipt.Pager(WebGridPagerModes.NextPrevious);
    WebGridColumn[] columnSetIncoming = new WebGridColumn[8];
    columnSetIncoming[0] = gridHoldReceipt.Column("", "", @<text><a class="EditDelete" onclick="CreateReceipt('@item.SocietyReceiptOnholdID.ToString()')" style="cursor: pointer;">Create Receipt</a></text>);
    columnSetIncoming[1] = gridHoldReceipt.Column("TransactionId", "Transaction Id", @<text><span>@item.TransactionId</span></text>, canSort: true);
    columnSetIncoming[2] = gridHoldReceipt.Column("CreatedOn", "Transaction Date", @<text><span>@String.Format("{0:dd-MMM-yyyy HH:mm:ss}", item.CreatedOn)</span></text>, canSort: true);
    columnSetIncoming[3] = gridHoldReceipt.Column("BuildingUnit", "Building Unit", @<text><span>@item.BuildingUnit</span></text>, canSort: false);
    columnSetIncoming[4] = gridHoldReceipt.Column("SocietyMember.Member", "Member Name", @<text><span>@item.SocietyMember.Member</span></text>, canSort: true);
    columnSetIncoming[5] = gridHoldReceipt.Column("BillAbbreviation", "Bill Abbreviation", @<text><span>@item.BillAbbreviation</span></text>, canSort: true);
    columnSetIncoming[6] = gridHoldReceipt.Column("Amount", "Amount", @<text><span>@item.Amount</span></text>, canSort: true, style: "AlignRight");
    columnSetIncoming[7] = gridHoldReceipt.Column("IsReceiptCreated", "Status", @<text><span>@(item.IsReceiptCreated ? "Receipt Created" : "On Hold") </span></text>, canSort: true);
    @gridHoldReceipt.GetHtml(tableStyle: "table", footerStyle: "webgrid-footer", rowStyle: "TableRow", alternatingRowStyle: "altTableRow", columns: gridHoldReceipt.Columns(columnSetIncoming));
}
else
{
    <table border="0" cellpadding="2" cellspacing="0" class="table">
        <tr class="TableRow">
            <td>Currently there are no Records
            </td>
        </tr>
    </table>
}

<br />
<div>
    @Html.ActionLink("Back", "Menu", "SocietySubscription", new { id = ViewBag.SocietySubscriptionID }, new { @class = "EditDelete" })
</div>

<div id="myModal1" class="modal">
    <!-- Modal content -->
    <div class="modal-content">
        @*<span class="close">&times;</span>*@
        <div class="loader"></div>
        <span>Please wait..</span>
    </div>
</div>

<script type="text/javascript">
    var modal = document.getElementById('myModal1');
    function CreateReceipt(SocietyReceiptOnholdID) {
        var flag = true;
        if (SocietyReceiptOnholdID == null) {
            flag = confirm("Are you sure, you want to create receipt for all.");
        }
        if (flag) {
            modal.style.display = "block";
            var objSocietyReceiptOnhold = {};
            objSocietyReceiptOnhold.SocietyID = '@societyId';
            objSocietyReceiptOnhold.SocietySubscriptionID = '@ViewBag.SocietySubscriptionID';
            objSocietyReceiptOnhold.SocietyReceiptOnholdID = SocietyReceiptOnholdID;
            $.post("/SocietyReceipt/CreateReceipt", objSocietyReceiptOnhold, function (response) {
                //if (response.status == "true") {
                //    //window.location = response.redirectUrl;
                //    alert("Receipt generated successfully.");
                //    location.reload();
                //} else {
                //    alert("Failed to generated Receipt.");
                //}
                modal.style.display = "none";
                location.reload();
            });
        }
    }
</script>
