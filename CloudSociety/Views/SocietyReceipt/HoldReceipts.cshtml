@model IEnumerable<CloudSocietyEntities.SocietyReceiptOnhold>
@{
    ViewBag.Title = "Society On Hold Receipts";
    ViewBag.Header = "Society On Hold Receipt List";
    ViewBag.SocietyNameHeader = ViewBag.SocietyHead;
    Layout = "~/Views/Shared/SocietyLayout.cshtml";
    Guid? societyId= null;
}
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.0/jquery.min.js"></script>
@if (!string.IsNullOrWhiteSpace(ViewBag.CreateReceiptStatusMessage))
{
    <span class="EditDelete">
        @ViewBag.CreateReceiptStatusMessage
    </span>
    <br />
    <br />
}
@if (Model.Count() > 0)
    {
    <input type="button" value="Create Receipt For All" onclick="CreateReceipt(null)" class="buttton" style="color: white !important; width: 145px;" />
<br />
<br />
}
    <table border="0" cellpadding="2" cellspacing="0" class="table">
        @{
            int Count = 1;
        }
        @foreach (var item in Model)
        {
            societyId = item.SocietyID;            
            if (Count == 1)
            {
            <tr>
                <th></th>
                <th>Transaction Id
                </th>
                <th>Transaction Date
                </th>
                <th>Building Unit
                </th>
                <th>Member Name
                </th>
                <th>Bill Abbreviation
                </th>
                <th>Amount
                </th>
            </tr>
            }  
            <tr @if ((Count % 2) == 0)
                { <text> class="TableRow" </text> }
                else
                { <text> class="altTableRow" </text>} >
                <td>
                    @if (!ViewBag.ReadOnly)
                    {                
                        <a class="EditDelete" onclick="CreateReceipt('@item.SocietyReceiptOnholdID.ToString()')" style="cursor: pointer;">Create Receipt</a>
                    }
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.TransactionId)
                </td>
                <td>
                    @String.Format("{0:dd-MMM-yyyy HH:mm:ss}", item.CreatedOn)
                </td>
                <td>
                    @item.SocietyBuildingUnit.SocietyBuilding.Building <span>- </span>@item.SocietyBuildingUnit.Unit
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.SocietyMember.Member)
                </td>
                <td style="text-align: center;">
                    @Html.DisplayFor(modelItem => item.BillAbbreviation)
                </td>
                <td align="right">
                    @Html.DisplayFor(modelItem => item.Amount)
                </td>
            </tr>
                    Count = Count + 1;
        }
        @if (Count == 1)
        {
            <tr class="TableRow">
                <td>Currently there are no Records
                </td>
            </tr> 
        }
    </table>
<br />
<div>
    @Html.ActionLink("Back", "Menu", "SocietySubscription", new { id = ViewBag.SocietySubscriptionID }, new { @class = "EditDelete" })
</div>

<div id="myModal1" class="modal">
    <!-- Modal content -->
    <div class="modal-content">
        @*<span class="close">&times;</span>*@
        <div class="loader"></div>
        <span>Please wait..</span>
    </div>
</div>

<script type="text/javascript">
    var modal = document.getElementById('myModal1');
    function CreateReceipt(SocietyReceiptOnholdID) {
        var flag = true;
        if (SocietyReceiptOnholdID == null) {
            flag = confirm("Are you sure, you want to create receipt for all.");
        }
        if (flag) {            
            modal.style.display = "block";
            var objSocietyReceiptOnhold = {};
            objSocietyReceiptOnhold.SocietyID = '@societyId';
            objSocietyReceiptOnhold.SocietySubscriptionID = '@ViewBag.SocietySubscriptionID';
            objSocietyReceiptOnhold.SocietyReceiptOnholdID = SocietyReceiptOnholdID;
            $.post("/SocietyReceipt/CreateReceipt", objSocietyReceiptOnhold, function (response) {
                //if (response.status == "true") {
                //    //window.location = response.redirectUrl;
                //    alert("Receipt generated successfully.");
                //    location.reload();
                //} else {
                //    alert("Failed to generated Receipt.");
                //}
                modal.style.display = "none";
                location.reload();
            });
        }
    }
</script>
