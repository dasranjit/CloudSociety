@model IEnumerable<CloudSocietyEntities.SocietyBillSeriesWithLastDates>
@{
    ViewBag.Title = "Bill Series";
    ViewBag.Header = "Bill Series";
    ViewBag.SocietyNameHeader = ViewBag.SocietyHead;
    Layout = "~/Views/Shared/SocietyLayout.cshtml";
    var lockedTillDate = (DateTime?)ViewBag.LockedTillDate;
}
@Html.ValidationSummary(false, "Following errors occurred while processing your request")
<div class="buttton" style="width: 65px;">
    @Html.ActionLink("Create New", "Create", new { id = ViewBag.SocietySubscriptionID })</div>
<br />
<table border="0" cellpadding="2" cellspacing="0" class="table">
    @{
        int Count = 1;
    }
    @foreach (var item in Model)
    {
        if (Count == 1)
        {
        <tr>
            <th>
            </th>
            <th>
                Bill Abbreviation
            </th>
            <th>
                Last Bill Date
            </th>
            <th>
                Last Receipt Date
            </th>
            <th>
                Billing Frequency
            </th>
            <th>
                Bill Day
            </th>
            <th>
                Due Days
            </th>
            <th>
                Interest Rate
            </th>
            <th>
                Minimum Interest
            </th>
            <th>
                OS Adjustment
            </th>
            @*
            <th>
                Note
            </th>*@
            <th>
                Tax
            </th>
            <th>
                Print Area
            </th>
        </tr>
        }
        <tr @if ((Count % 2) == 0)
            { <text> class="TableRow" </text> }
            else
            { <text> class="altTableRow" </text>} >
            <td>
            @if ((bool)ViewBag.YearOpen)
            {
                @Html.ActionLink("Generate Bill", "Create", "SocietyBill", new { id = ViewBag.SocietySubscriptionID, billAbbreviation = item.BillAbbreviation }, new { @class = "EditDelete" })
                    <text>|</text>
                //if (item.LastBillDate != null && (item.LastReceiptDate == null || item.LastBillDate > item.LastReceiptDate))
                if (item.LastBillDate != null && (item.LastReceiptDate == null || item.LastBillDate > item.LastReceiptDate) && (lockedTillDate == null || item.LastBillDate > lockedTillDate))
                    {
                    @Html.ActionLink("Delete Bills", "Delete", "SocietyBill", new { societySubscriptionID = ViewBag.SocietySubscriptionID, lastBillDate = item.LastBillDate, billAbbreviation = item.BillAbbreviation }, new { @class = "EditDelete" })
                <text>|</text>
                }
            }
                @Html.ActionLink("Edit", "Edit", new { code = item.BillAbbreviation, societySubscriptionID = ViewBag.SocietySubscriptionID }, new { @class = "EditDelete" })
                @if (item.LastBillDate == null && item.LastReceiptDate == null)
                {
                    <text>|</text>
                     @Html.ActionLink("Delete", "Delete", new { code = item.BillAbbreviation, societySubscriptionID = ViewBag.SocietySubscriptionID }, new { @class = "EditDelete" })
                }
            </td>
            <td align="center">
                @Html.DisplayFor(modelItem => item.BillAbbreviation)
            </td>
            <td>
                @String.Format("{0:dd-MMM-yyyy}", item.LastBillDate)
            </td>
            <td>
                @String.Format("{0:dd-MMM-yyyy}", item.LastReceiptDate)
            </td>
            <td align="center">
                @*@(item.BillingFrequency == "M" ? "Monthly" : (item.BillingFrequency == "Q" ? "Quarterly" : (item.BillingFrequency == "H" ? "Half-Yearly" : (item.BillingFrequency == "Y" ? "Yearly" : ""))))*@
                @(item.BillingFrequency == "M" ? "Monthly" : (item.BillingFrequency == "B" ? "Bi-Monthly" : (item.BillingFrequency == "Q" ? "Quarterly" : (item.BillingFrequency == "H" ? "Half-Yearly" : (item.BillingFrequency == "Y" ? "Yearly" : "")))))
            </td>
            <td align="center">
                @Html.DisplayFor(modelItem => item.BillDay)
            </td>
            <td align="center">
                @Html.DisplayFor(modelItem => item.DueDays)
            </td>
            <td align="center">
                @Html.DisplayFor(modelItem => item.InterestRate)
            </td>
            <td align="center">
                @Html.DisplayFor(modelItem => item.MinimumInterest)
            </td>
            <td>
                @(item.OSAdjustment == "A" ? "Tax/Int/NonChg/Chg" : (item.OSAdjustment == "B" ? "Tax/Chg/Int/NonChg" : ""))
            </td>
            @*
            <td>
                @Html.DisplayFor(modelItem => item.Note)
            </td>*@
            <td>
                @Html.DisplayFor(modelItem => item.Tax)
            </td>
            <td width="35px" align="center">
                @if (item.PrintArea == true)
                { <text>
                    <img alt="Selected" src="@Url.Content("~/Content/Images/tick-green.png")"  />
                    </text> }
                else
                { <text>
                    <img alt="Not Selected" src="@Url.Content("~/Content/Images/Copy of cancel-icon.png")" /></text> }
            </td>
        </tr>
                Count = Count + 1;
    }
    @if (Count == 1)
    {<tr class="TableRow">
        <td>
            Currently there are no Records
        </td>
    </tr> }
</table>
<br />
<div>
    @Html.ActionLink("Back", "Menu", "SocietySubscription", new { id = ViewBag.SocietySubscriptionID }, new { @class = "EditDelete" })
</div>
