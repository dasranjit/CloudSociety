@model CloudSocietyEntities.Communication
@{
    ViewBag.Title = "Publish Message";
    ViewBag.Header = " Publish Message ";
    ViewBag.SocietyNameHeader = ViewBag.SocietyHead;
    Layout = "~/Views/Shared/SocietyLayout.cshtml";
    bool IsFullAccess = new CloudSociety.Controllers.AppInfoController().IsFullAccess();
   
}
<script type="text/javascript">

    function selectAll(objThis, tableId) {
        if (objThis.checked) {
            $('#' + tableId).find('input').each(function () {
                this.checked = true;
                $($(this).parent()).parent().removeClass("altTableRow").addClass("TableRow");
            });

        } else {
            $('#' + tableId).find('input').each(function () {
                this.checked = false;
                $($(this).parent()).parent().removeClass("TableRow").addClass("altTableRow");
            });
        }
        DisableOfficeBearers(objThis);
    }

    function DisableOfficeBearers(objThis) {
        if (objThis.id == "Members") {
            if (objThis.checked) {
                var objOfficeBearers = $("#OfficeBearers");
                objOfficeBearers[0].checked = false
                objOfficeBearers.attr("disabled", true);
                $('#tblOfficebearer').find('input').each(function () {
                    this.checked = false;
                    $(this).attr("disabled", true);
                    $($(this).parent()).parent().removeClass("TableRow").addClass("altTableRow");
                });
            }
            else {
                $("#OfficeBearers").removeAttr("disabled");
                $('#tblOfficebearer').find('input').each(function () {
                    $(this).removeAttr("disabled");
                });
            }
        }
    }

    function selectOne(objThis, selectAllId, tableId) {
        if ($('#' + tableId).find('input').length == $('#' + tableId).find('input:checked').length) {
            $('#' + selectAllId)[0].checked = true;
        } else {
            $('#' + selectAllId)[0].checked = false;
        }
        if (objThis.checked) {
            $($(objThis).parent()).parent().removeClass("altTableRow").addClass("TableRow");
        } else {
            $($(objThis).parent()).parent().removeClass("TableRow").addClass("altTableRow");
        }
        DisableOfficeBearers($('#' + selectAllId)[0]);
    }
    function setValueToHiddenfields() {
        var selectedList = "";
        if (!$('#OfficeBearers')[0].checked) {
            $('#tblOfficebearer').find('input').each(function () {
                if (this.checked) {
                    selectedList = selectedList == "" ? selectedList + this.id : selectedList + ',' + this.id;
                }
            });
            $('#OfficeBearersList').val(selectedList);
        }
        if (!$('#Members')[0].checked) {
            selectedList = "";
            $('#tblMember').find('input').each(function () {
                if (this.checked) {
                    selectedList = selectedList == "" ? selectedList + this.id : selectedList + ',' + this.id;
                }
            });
            $('#MemberList').val(selectedList);
        }
    }
</script>

@using (Html.BeginForm())
{
    @Html.HiddenFor(model => model.CommunicationID) 
    @Html.HiddenFor(model => model.OfficeBearersList) 
    @Html.HiddenFor(model => model.MemberList) 
    @Html.ValidationSummary(false, "Following errors occurred while processing your request")  
    <fieldset style="width: 98%">
        <legend>Message</legend>
        <table style="width: 94%">
            <tr>
                <td style="width: 10%">Type </td>
                <td style="width: 5%">:</td>
                <td style="width: 85%">
                    @ViewBag.ct
                </td>
            </tr>
            <tr>
                <td>Subject</td>
                <td>:</td>
                <td>
                    @Html.DisplayFor(model => model.Subject)
                </td>
            </tr>
            <tr>
                <td>Message</td>
                <td>:</td>
                <td>
                    @Html.DisplayFor(model => model.Details)
                </td>
            </tr>
            <tr>
                <td>File</td>
                <td>:</td>
                <td>
                    <table>
                        <tr>
                            <td>
                                @if (!string.IsNullOrEmpty(ViewBag.FilePath) && !string.IsNullOrEmpty(ViewBag.FileName))
                                {
                                    @Html.Hidden("hdnEditFilePath", (string)ViewBag.FilePath)
                                    @Html.Hidden("hdnEditFileName", (string)ViewBag.FileName)
                                    @Html.Partial("PVDisplayFileContains")
                                }
                                else
                                {
                                    <span>File not available.</span>
                                }
                            </td>
                            @if (ViewBag.ShowEmailAndSms)
                            {
                                <td>&nbsp;</td>
                                <td>@Html.CheckBox("SendSMS", true) Send SMS</td>
                                <td>&nbsp;</td>
                                <td>@Html.CheckBox("SendEmail", true) Send Email</td>
                            }
                            else
                            {
                                @Html.Hidden("SendSMS", false)
                                @Html.Hidden("SendEmail", false)
                            }

                        </tr>
                    </table>
                </td>
            </tr>


            @if (IsFullAccess)
            {
                if (Roles.IsUserInRole(Membership.GetUser().UserName, "OfficeBearer") ||
                    (Model.Society.SocietyCommunicationSettings.FirstOrDefault().AllowToSendSmsAndEmailForGD &&
                    Model.CommunicationType.CommunicationType1.Trim().ToUpper() == "GROUP DISCUSSION"))
                {
                    <tr>
                    <td colspan="3">
                        <hr />
                    </td>
                </tr>
                    if (Model.CommunicationType.IsToSendSelective)
                    {
                        List<CloudSocietyEntities.MemberRecipient> objOfficebearerList = ViewBag.OfficebearerList;
                        List<CloudSocietyEntities.MemberRecipient> objMemberList = ViewBag.MemberList;                                       
                
                        <tr>
                    <td colspan="3" style="width: 100%">
                        <table style="width: 100%">
                            <tr class="TableRow">
                                <td>&nbsp;&nbsp;@Html.CheckBox("OfficeBearers", true, new { onclick = "selectAll(this,'tblOfficebearer')" })&nbsp;&nbsp;&nbsp;&nbsp;Select All Office Bearers</td>
                                <td>&nbsp;&nbsp;@Html.CheckBox("Members", false, new { onclick = "selectAll(this,'tblMember')" })&nbsp;&nbsp;&nbsp;&nbsp;Select All Members</td>
                            </tr>
                            <tr>
                                <td style="width: 50%; text-align: left; vertical-align: top;">
                                    <div style="height: 200px; overflow-y: scroll;">
                                        <table border="0" cellpadding="2" cellspacing="0" class="table" id="tblOfficebearer">

                                            @foreach (var officebearer in objOfficebearerList)
                                            {
                                                <tr class="TableRow">
                                                    <td>
                                                        <input type="checkbox" onclick="selectOne(this, 'OfficeBearers', 'tblOfficebearer')" checked="checked" id="@officebearer.SocietyMemberID" />
                                                    </td>
                                                    <td>@officebearer.Member </td>
                                                </tr>                                
                                            }
                                        </table>
                                    </div>
                                </td>
                                <td style="width: 50%; text-align: left; vertical-align: top;">
                                    <div style="height: 200px; overflow-y: scroll;">
                                        <table border="0" cellpadding="2" cellspacing="0" class="table" id="tblMember">
                                            @foreach (var member in objMemberList)
                                            {
                                                <tr class="altTableRow">
                                                    <td>
                                                        <input type="checkbox" onclick="selectOne(this, 'Members', 'tblMember')" id="@member.SocietyMemberID" />
                                                    </td>
                                                    <td>@member.Member</td>
                                                </tr>
                                            }
                                        </table>
                                    </div>
                                </td>
                            </tr>
                        </table>
                    </td>
                </tr>
                    }
                    else
                    {
                        <tr>
                    <td style="text-align: center;" colspan="4">Send to :&nbsp;&nbsp;&nbsp;&nbsp;
                        Office Bearers&nbsp;@Html.CheckBox("OfficeBearers", true)&nbsp;&nbsp;&nbsp;&nbsp;
                        Members&nbsp;@Html.CheckBox("Members", false)&nbsp;&nbsp;&nbsp;&nbsp;
                        Tenants&nbsp;<input type="checkbox" id="Tenants" name="Tenants" disabled="disabled" />
                    </td>
                </tr>   
                    }
                }
                else
                {
                    @Html.Hidden("OfficeBearers", true)
                    @Html.Hidden("Members", false)
                }

                <tr>
                    <td style="text-align: center;" colspan="4">
                        <input type="submit" value="Publish" class="buttton" style="width: 45px; height: 23px;" onclick="setValueToHiddenfields()" />
                    </td>
                </tr> 
            }
        </table>
    </fieldset>
    @Html.Hidden("id", (Guid)ViewBag.id)     
    @Html.Hidden("IsPublishByApprover", (bool)ViewBag.IsPublishByApprover) 
}
@Html.ActionLink("Back to List", "Index", new { id = (Guid)ViewBag.id }, new { @class = "EditDelete" })
